USE_OCAMLFIND = true
OCAMLPACKS[] = \
  netstring \
  cryptokit \
  calendar \
  cohttp \
  lwt.syntax \
  xmlm \
  lwt \
  yojson


NATIVE_ENABLED = true
BYTE_ENABLED = true

OCAMLFLAGS  += -dtypes 
OCAMLFINDFLAGS += -syntax camlp4o

FILES[] = s3 eC2 sQS http_method aws_util creds xml policy

LIB = aws
OCAML_LIBS[] = $(LIB)

ec2sh: ec2sh.ml $(LIB).cma
  $(OCAMLFIND) ocamlmktop $(OCAMLFLAGS) -package $(string $(OCAMLPACKS)) $(LIB).cma ec2sh.ml -o ec2sh -linkpkg

sqstest: keys.ml sqstest.ml $(LIB).cma
  $(OCAMLFIND) ocamlc -package $(string $(OCAMLPACKS)) $^ -o $@ -linkpkg 

.DEFAULT: $(OCamlLibrary $(LIB), $(FILES)) \
  $(OCamlProgram s3c, s3c) ec2sh

.PHONY:  clean

clean:
	rm -f $(filter-proper-targets $(ls R, .)) *.s *.annot